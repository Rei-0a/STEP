# 課題1 ハッシュ表を作成する

## 1. Context

O(1)で探索、削除、追加ができる必要がある。
ハッシュテーブルの仕組みを理解するために、自分で実装する。

- put(key, value) :  入力された単語の追加
- get(key) : 入力された単語の検索
- delete(key) : 入力された単語の削除

## 2. Goal

- 要素数に応じてハッシュ表が変化すること

## 3. Non-Goals

<!-- 明確に対応しない範囲

 期待されそうだけど対象外なもの（誤解防止） -->

## 4. 概要（Overview / High-level Design）

### 構成

< Item Class >
key : ハッシュ値（配列のインデックス）
value : 値
next : 次のノードへのポインタ

<!-- 
- システム全体の構造や流れを図や文章で説明
- コンポーネントの役割やデータの流れ
- アーキテクチャ図があると◎ -->

## 5. 詳細設計（Detailed Design）

<!-- - 各コンポーネント/モジュールの詳細
- API仕様、データ構造、クラス設計など
- 例：
  - 新しいクラスとその責務
  - API endpoint の定義（メソッド、パス、リクエスト/レスポンス形式） -->

### 再ハッシュ関数（new_bucket_sizeが引数)

```

self.buckets = [ ..., (key1 → key2), ..., None, (key3), ... ]
self.bucket_size = 今のサイズ

```

1. 古いハッシュ表全体をold_bucketsに保存
2. 新しいハッシュ表を作成(self.buckets = [None] * new_bucket_size)
3. 古いハッシュ表に入っている単語を探索
   1. 古い単語のheaderを取得
   2. headerがNoneでなくなるまで、新しいハッシュ値を計算して、ハッシュテーブルにいれる

```
while header:   # それぞれのハッシュ表の先頭

  bucket_index = calculate_hash(header.key) % new_bucket_size # 新しいハッシュ値を計算
  new_item = Item(header.key, header.value, self.buckets[bucket_index]) # 新しいアイテムを作って、最初に追加する
  self.buckets[bucket_index] = new_item   # 最初に挿入(LIFO)

  header = header.next
```

## 6. 代替案の検討（Alternatives Considered）

<!-- - 他のアプローチとその比較
- なぜ今回の設計を選んだのか
- 落とし穴やトレードオフの説明 -->

### ハッシュ関数の比較

1. i文字目に10^iをかける
2. 文字全てのordをかける


|    | ord(i)+10^i | hash *= ord(i) |
| -- | ----------- | -------------- |
| 0  | 0.100624    | 0.048459       |
| 1  | 0.146909    | 0.081661       |
| 2  | 0.1563      | 0.056911       |
| 3  | 0.275311    | 0.090762       |
| 4  | 0.227218    | 0.03903        |
| 5  | 0.331004    | 0.077833       |
| 6  | 0.761513    | 0.174899       |
| 7  | 0.493801    | 0.046041       |
| 8  | 0.69877     | 0.058053       |
| 9  | 0.737531    | 0.046721       |
| 10 | 0.862297    | 0.05935        |
| 11 | 0.984339    | 0.052928       |
| 12 | 1.34463     | 0.06734        |
| 13 | 2.150926    | 0.310123       |
| 14 | 1.135038    | 0.053311       |
| 15 | 1.355901    | 0.058846       |
| 16 | 1.567739    | 0.059047       |
| 17 | 1.719571    | 0.057381       |
| 18 | 1.867104    | 0.06689        |
| 19 | 2.112569    | 0.062732       |
| 20 | 2.216952    | 0.068738       |
| 21 | 2.407851    | 0.067558       |
| 22 | 2.664577    | 0.07274        |
| 23 | 2.786356    | 0.079428       |
| 24 | 2.842329    | 0.078809       |
| 25 | 3.156929    | 0.210817       |
| 26 | 3.21034     | 0.085676       |
| 27 | 5.057177    | 0.665538       |
| 28 | 2.657656    | 0.07086        |
| 29 | 2.924897    | 0.073151       |
| 30 | 3.165248    | 0.072603       |
| 31 | 3.102131    | 0.07263        |
| 32 | 3.289107    | 0.082938       |
| 33 | 3.345898    | 0.077533       |
| 34 | 3.588207    | 0.081922       |
| 35 | 3.828       | 0.080134       |
| 36 | 4.244382    | 0.083776       |
| 37 | 4.251416    | 0.090277       |
| 38 | 4.546414    | 0.134833       |
| 39 | 4.61537     | 0.09094        |
| 40 | 4.929468    | 0.090947       |
| 41 | 5.598977    | 0.091343       |
| 42 | 5.008898    | 0.096574       |
| 43 | 5.079772    | 0.097712       |
| 44 | 5.355065    | 0.102543       |
| 45 | 5.454926    | 0.102257       |
| 46 | 5.536851    | 0.106246       |
| 47 | 5.756057    | 0.104716       |
| 48 | 5.842801    | 0.109715       |
| 49 | 5.977688    | 0.115566       |
| 50 | 6.184557    | 0.108435       |
| 51 | 6.801843    | 0.402238       |
| 52 | 6.542828    | 0.1181         |
| 53 | 6.504495    | 0.120185       |
| 54 | 6.995063    | 0.129146       |
| 55 | 8.319055    | 1.690059       |
| 56 | 5.155392    | 0.112349       |
| 57 | 5.621383    | 0.11753        |
| 58 | 5.868863    | 0.113027       |
| 59 | 6.235745    | 0.119822       |
| 60 | 5.917352    | 0.117716       |
| 61 | 5.844575    | 0.121269       |
| 62 | 5.880315    | 0.127217       |
| 63 | 6.131408    | 0.129349       |
| 64 | 6.126279    | 0.129612       |
| 65 | 6.091614    | 0.12801        |
| 66 | 6.286378    | 0.132298       |
| 67 | 6.455896    | 0.139074       |
| 68 | 6.637992    | 0.135336       |
| 69 | 6.687076    | 0.140498       |
| 70 | 6.926351    | 0.14097        |
| 71 | 7.499604    | 0.146476       |
| 72 | 7.62197     | 0.14461        |
| 73 | 7.599763    | 0.149169       |
| 74 | 8.507038    | 0.151699       |
| 75 | 7.764588    | 0.150606       |
| 76 | 8.048763    | 0.611668       |
| 77 | 7.951726    | 0.161944       |
| 78 | 8.327826    | 0.15831        |
| 79 | 8.471071    | 0.163449       |
| 80 | 8.546567    | 0.171158       |
| 81 | 8.549347    | 0.168968       |
| 82 | 8.940045    | 0.167036       |
| 83 | 9.211868    | 0.170213       |
| 84 | 9.236025    | 0.173841       |
| 85 | 9.395136    | 0.175054       |
| 86 | 10.452126   | 0.18138        |
| 87 | 9.604464    | 0.176823       |
| 88 | 9.858622    | 0.180594       |
| 89 | 10.02558    | 0.189517       |
| 90 | 10.232065   | 0.186589       |
| 91 | 9.819367    | 0.189479       |
| 92 | 10.009598   | 0.19031        |
| 93 | 10.416685   | 0.193622       |
| 94 | 11.849733   | 0.19334        |
| 95 | 12.071471   | 0.197398       |
| 96 | 14.779898   | 0.216241       |
| 97 | 16.364214   | 0.228066       |
| 98 | 16.768384   | 0.204664       |
| 99 | 16.062574   | 0.207693       |

## 8. Open Questions

要素数が
    テーブルサイズの70%以上→テーブルサイズを2倍に
    テーブルサイズの30%以下→テーブルサイズを半分に
    テーブルサイズは奇数になるように調整すると衝突が減る！
ってしたけど、要素サイズだったら、全部が同じハッシュ値のときに無駄な気がしてしまう

|    | delete追加後 | 再ハッシュ追加 |
| -- | ------------ | -------------- |
| 0  | 0.173461     | 0.152137       |
| 1  | 0.446066     | 0.375360       |
| 2  | 0.737767     | 0.428901       |
| 3  | 1.903551     | 0.994531       |
| 4  | 2.309710     | 0.998585       |
| 5  | 2.933915     | 1.391268       |
| 6  | 3.910172     | 3.195585       |
| 7  | 4.708501     | 2.062178       |
| 8  | 5.670644     | 2.671113       |
| 9  | 6.620760     | 3.447553       |
| 10 | 7.426284     | 4.174071       |
| 11 | 8.669435     | 4.940521       |
| 12 | 10.292811    | 5.541485       |
| 13 | 10.746608    | 8.913878       |
| 14 | 11.923239    | 5.154517       |
| 15 | 12.834364    | 5.976301       |
| 16 | 13.764087    | 6.382113       |
| 17 | 14.952469    | 7.035882       |
| 18 | 15.216579    | 7.689575       |
| 19 | 16.709612    | 8.767005       |
| 20 | 17.373407    | 9.438327       |
| 21 | 18.556663    | 9.926766       |
| 22 | 19.945317    | 11.043416      |
| 23 | 20.498146    | 11.563988      |
| 24 | 22.214007    | 12.276625      |
| 25 | 22.681324    | 12.815739      |
| 26 | 23.899294    | 13.624502      |
| 27 | 25.061849    | 19.097142      |
| 28 | 25.450991    | 11.074549      |
| 29 | 26.298644    | 11.813620      |
| 30 | 27.593229    | 12.590825      |

<!-- 
## 6. 代替案の検討（Alternatives Considered）

- 他のアプローチとその比較
- なぜ今回の設計を選んだのか
- 落とし穴やトレードオフの説明

## 7. テスト計画（Testing Plan）

- 単体テスト・統合テスト・E2E テストなど
- テストの対象と手法
- 失敗ケースや境界条件もカバーしているか

## 8. Open Questions）

- 現時点での不確実な部分やリスク
- 要議論事項（明確でなくてもOK）

## 10. 関連資料・リンク（Appendix / References）

- 関連 issue, PR, 設計資料、ミーティングノートなど -->
